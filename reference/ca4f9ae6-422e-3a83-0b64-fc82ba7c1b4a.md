# AnsiFilter Class


Helper class used to automatically detect and correctly load VCF files stored in a code page other than UTF-8.



## Definition
**Namespace:** <a href="67dce261-ab8f-dd0a-4c0c-bc2633c1719e.md">FolkerKinzel.VCards</a>  
**Assembly:** FolkerKinzel.VCards (in FolkerKinzel.VCards.dll) Version: 7.2.0-beta.1+92a9170dd6e89cb66392c26e0acddb6434e3fbc1

**C#**
``` C#
public sealed class AnsiFilter
```
**VB**
``` VB
Public NotInheritable Class AnsiFilter
```
**C++**
``` C++
public ref class AnsiFilter sealed
```
**F#**
``` F#
[<SealedAttribute>]
type AnsiFilter = class end
```

<table><tr><td><strong>Inheritance</strong></td><td><a href="https://learn.microsoft.com/dotnet/api/system.object" target="_blank" rel="noopener noreferrer">Object</a>  →  AnsiFilter</td></tr>
</table>



## Remarks

VCF files of the vCard 2.1 standard were previously saved by Outlook and Outlook Express in the ANSI encoding of the current Windows system, without always encoding the extended characters with quoted printable encoding. In principle, VCF files of the vCard 3.0 standard can also be ANSI-encoded if, for example, they were transmitted in an e-mail that specified the encoding in its content header. UTF-8 encoding has only been mandatory since vCard 4.0.

This class is a wrapper around the <a href="e4c668da-51c5-9ccc-1452-fd0f7556851c.md">Load(String, Encoding)</a> method that initially loads the file as UTF-8. If a decoding error occurs, the method examines the <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects for any <a href="3635e614-024c-d444-e5e0-566ed843db9a.md">CharSet</a> (`CHARSET`) parameters, which provide an indication of the <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a> to be used. If a hint is found, the file is reloaded with the determined <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a>, otherwise with the <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a> specified in the <a href="46000fe8-fb3e-40c9-759a-96d3a40032c4.md">constructor</a> as a fallback.

(The `CHARSET` parameter exists only in the vCard 2.1 standard.)


## Example



<table>
	<tr>
		<th>
			<img src="media/AlertNote.png" alt="Note">
				
			</img>  Note
		</th>
	</tr>
	<tr>
		
		<td>
		To make the code more readable, exception handling has been omitted from the examples.</td>
	</tr>
</table>



**C#**  
``` C#
using System.Diagnostics;
using FolkerKinzel.VCards;

namespace Examples;

public static class AnsiFilterExample
{
    /// <summary>
    /// The example loads several vCard 2.1 files which have different encodings and 
    /// shows their content in the text editor. The encoding is selected automatically.
    /// </summary>
    /// <param name="directoryPath">Path to the directory containing the example files.</param>
    /// <remarks>
    /// See the VCF files used in this example at
    /// https://github.com/FolkerKinzel/VCards/tree/master/src/Examples/AnsiFilterExamples
    /// </remarks>
    public static void LoadVcfFilesWhichHaveDifferentAnsiEncodings(string directoryPath)
    {
        // If you have to read VCF files that might have ANSI encodings, use the AnsiFilter
        // to read them automatically with the right encoding.
        // Give the constructor as an argument the ANSI code page that is most likely. This
        // will be the fallback code page if a VCF file couldn't be loaded as UTF-8 and didn't 
        // contain a CHARSET parameter. In our example we choose windows-1255 (Hebrew).
        var ansiFilter = new AnsiFilter(1255);

        var outFileName = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString() + ".txt");

        using (StreamWriter writer = File.AppendText(outFileName))
        {
            foreach (string vcfFileName in Directory
                .EnumerateFiles(directoryPath)
                .Where(x => StringComparer.OrdinalIgnoreCase.Equals(Path.GetExtension(x), ".vcf")))
            {
                IList<VCard> vCards = Vcf.Load(vcfFileName, ansiFilter);
                WriteToTextFile(vcfFileName, vCards, ansiFilter.UsedEncoding.WebName, writer);
            }
        }

        ShowInTextEditorAndDelete(outFileName);
    }

    private static void WriteToTextFile(string vcfFileName,
                                        IList<VCard> vCards,
                                        string? encodingWebName,
                                        TextWriter writer)
    {
        const string indent = "    ";
        writer.Write(Path.GetFileName(vcfFileName));
        writer.WriteLine(':');
        writer.Write(indent);
        writer.WriteLine(vCards.FirstOrDefault()?.DisplayNames?.FirstOrDefault()?.Value);
        writer.Write(indent);
        writer.Write("Encoding: ");
        writer.WriteLine(encodingWebName);
        writer.WriteLine();
    }

    private static void ShowInTextEditorAndDelete(string outFileName)
    {
        Process.Start(new ProcessStartInfo { FileName = outFileName, UseShellExecute = true })?
               .WaitForExit();
        File.Delete(outFileName);
    }
}

/*
Output:

 German.vcf:
    Sören Täve Nüßlebaum
    Encoding: windows-1252

Greek.vcf:
    Βαγγέλης
    Encoding: windows-1253

Hebrew.vcf:
    אפרים קישון
    Encoding: windows-1255

Ukrainian.vcf:
    Віталій Володимирович Кличко
    Encoding: windows-1251

utf-8.vcf:
    孔夫子
    Encoding: utf-8

Please note that Hebrew.vcf and utf-8.vcf have been read properly without
any CHARSET parameter in the VCF files: UTF-8 is the default character set 
and windows-1255 (Hebrew) had been set as the default fallback value in the 
AnsiFilter constructor.
 */
```


## Constructors
<table>
<tr>
<td><a href="82f456e2-cfd9-cc91-f87c-54516db2f5ff.md">AnsiFilter(Int32)</a></td>
<td>Initializes an instance of the AnsiFilter class with the number of the code page to use for the reading of VCF files that are not UTF-8 and that do not contain a hint in their CHARSET parameters which suggests the use of a different <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a>.</td></tr>
<tr>
<td><a href="46000fe8-fb3e-40c9-759a-96d3a40032c4.md">AnsiFilter(String)</a></td>
<td>Initializes an instance of the AnsiFilter class with the <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding.webname" target="_blank" rel="noopener noreferrer">WebName</a> property of the <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a> object to use for reading VCF files that are not UTF-8 and that do not contain a hint in their CHARSET parameters which suggests the use of a different <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a>.</td></tr>
</table>

## Properties
<table>
<tr>
<td><a href="c3ee99c7-756e-a6fe-4d50-fc0a95001912.md">FallbackEncoding</a></td>
<td>The <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a> object to use as fallback.</td></tr>
<tr>
<td><a href="c7ae4a5c-ff9b-1e2d-9de6-213198d954f2.md">UsedEncoding</a></td>
<td>The <a href="https://learn.microsoft.com/dotnet/api/system.text.encoding" target="_blank" rel="noopener noreferrer">Encoding</a> used to read the VCF file.</td></tr>
</table>

## Methods
<table>
<tr>
<td><a href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)" target="_blank" rel="noopener noreferrer">Equals</a></td>
<td>Determines whether the specified object is equal to the current object.<br />(Inherited from <a href="https://learn.microsoft.com/dotnet/api/system.object" target="_blank" rel="noopener noreferrer">Object</a>)</td></tr>
<tr>
<td><a href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode" target="_blank" rel="noopener noreferrer">GetHashCode</a></td>
<td>Serves as the default hash function.<br />(Inherited from <a href="https://learn.microsoft.com/dotnet/api/system.object" target="_blank" rel="noopener noreferrer">Object</a>)</td></tr>
<tr>
<td><a href="https://learn.microsoft.com/dotnet/api/system.object.gettype" target="_blank" rel="noopener noreferrer">GetType</a></td>
<td>Gets the <a href="https://learn.microsoft.com/dotnet/api/system.type" target="_blank" rel="noopener noreferrer">Type</a> of the current instance.<br />(Inherited from <a href="https://learn.microsoft.com/dotnet/api/system.object" target="_blank" rel="noopener noreferrer">Object</a>)</td></tr>
<tr>
<td><a href="https://learn.microsoft.com/dotnet/api/system.object.tostring" target="_blank" rel="noopener noreferrer">ToString</a></td>
<td>Returns a string that represents the current object.<br />(Inherited from <a href="https://learn.microsoft.com/dotnet/api/system.object" target="_blank" rel="noopener noreferrer">Object</a>)</td></tr>
</table>

## Thread Safety
Any public `static` (`Shared` in Visual Basic) members of this type are thread safe. Any instance members are not guaranteed to be thread safe.

## See Also


#### Reference
<a href="67dce261-ab8f-dd0a-4c0c-bc2633c1719e.md">FolkerKinzel.VCards Namespace</a>  
