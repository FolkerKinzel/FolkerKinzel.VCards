# Dereference Method


Returns a collection of <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects in which the <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a>s referenced by their <a href="5913b05b-0099-90a2-2736-25ace1bce6f9.md">ID</a> property are embedded in <a href="fafb9a2d-3fc2-1db2-dd49-90299dc5fc8e.md">RelationProperty</a> objects, provided that *vCards* contains these <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects.



## Definition
**Namespace:** <a href="67dce261-ab8f-dd0a-4c0c-bc2633c1719e.md">FolkerKinzel.VCards</a>  
**Assembly:** FolkerKinzel.VCards (in FolkerKinzel.VCards.dll) Version: 7.2.0-beta.1+92a9170dd6e89cb66392c26e0acddb6434e3fbc1

**C#**
``` C#
public static IList<VCard> Dereference(
	IEnumerable<VCard?> vCards
)
```
**VB**
``` VB
Public Shared Function Dereference ( 
	vCards As IEnumerable(Of VCard)
) As IList(Of VCard)
```
**C++**
``` C++
public:
static IList<VCard^>^ Dereference(
	IEnumerable<VCard^>^ vCards
)
```
**F#**
``` F#
static member Dereference : 
        vCards : IEnumerable<VCard> -> IList<VCard> 
```



#### Parameters
<dl><dt>  <a href="https://learn.microsoft.com/dotnet/api/system.collections.generic.ienumerable-1" target="_blank" rel="noopener noreferrer">IEnumerable</a>(<a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a>)</dt><dd>A collection of <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects. The collection may be empty or may contain <code>null</code> values.</dd></dl>

#### Return Value
<a href="https://learn.microsoft.com/dotnet/api/system.collections.generic.ilist-1" target="_blank" rel="noopener noreferrer">IList</a>(<a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a>)  
A collection of <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects in which the <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a>s referenced by their <a href="5913b05b-0099-90a2-2736-25ace1bce6f9.md">ID</a> property are embedded in <a href="fafb9a2d-3fc2-1db2-dd49-90299dc5fc8e.md">RelationProperty</a> objects, provided that *vCards* contains these <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects.

## Remarks



<table>
	<tr>
		<th>
			<img src="media/AlertCaution.png" alt="Caution note">
				
			</img>  Caution
		</th>
	</tr>
	<tr>
		
		<td>
		Although the method itself is thread-safe, the <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects passed to the method are not. Block read and write access to these <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects, while this method is being executed!</td>
	</tr>
</table>




IMPORTANT: The method doesn't change anything in the argument *vCards*. Don't forget to assign the return value!

The method is automatically called by the deserialization methods of the <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> class. Using it in your own code can be useful, e.g., if <a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard</a> objects from different sources are combined in a common list in order to make their data searchable.


## Example

The example shows the deserialization and analysis of a VCF file whose content refers to other VCF files. The example uses the extension method <a href="d288b306-4af9-bd01-1179-0484af65f409.md">Dereference(IEnumerable(VCard))</a>, which calls Dereference(IEnumerable(VCard)).



<table>
	<tr>
		<th>
			<img src="media/AlertNote.png" alt="Note">
				
			</img>  Note
		</th>
	</tr>
	<tr>
		
		<td>
		For the sake of easier readability, exception handling has not been used in the example.</td>
	</tr>
</table>



**C#**  
``` C#
using FolkerKinzel.VCards;
using FolkerKinzel.VCards.Enums;
using FolkerKinzel.VCards.Extensions;

namespace Examples;

/// <summary>
/// This example will save a vCard 4.0 Group-vCard and its members in separate
/// VCF files and will reload all these files and then read data from the group VCard.
/// Although the example shows that this is possible, it is generally recommended 
/// to save group VCards and their members in a common VCF file: In this case, the 
/// Reference and Dereference methods would not have to be called in own code.
/// </summary>
public static class VCard40Example
{
    public static void SaveSingleVCardAsVcf(string directoryPath)
    {
        const string vcfExtension = ".vcf";

        // Note that argument validation and exception handling is completely omitted in this
        // example. The following "if" statement only ensures, that the method doesn't destroy
        // valueable data.
        if (Directory.GetFiles(directoryPath)
                     .Any(x => x.EndsWith(vcfExtension, StringComparison.OrdinalIgnoreCase)))
        {
            Console.WriteLine("The method \"SaveSingleVCardAsVcf(string)\" could not be executed");
            Console.WriteLine("because the destination directory contains .VCF files, that might");
            Console.WriteLine("be overwritten.");

            return;
        }

        // Initialize a group vCard with composers names and live dates:
        VCard? composersVCard = VCardBuilder
            .Create()
            .DisplayNames.Add("Composers")
            .Kind.Set(Kind.Group)
            .Members.Add(InitializeComposerVCard(
                    "Sergei Rachmaninoff", new DateOnly(1873, 4, 1), new DateOnly(1943, 3, 28)))
            .Members.Add(InitializeComposerVCard(
                    "Ludwig van Beethoven", new DateOnly(1770, 12, 17), new DateOnly(1827, 3, 26)))
            .Members.Add(InitializeComposerVCard(
                    "Frédéric Chopin", new DateOnly(1810, 3, 1), new DateOnly(1849, 10, 17)))
            .VCard;

        // (The easiest way would be to save everything in a common VCF file:)
        // composersVCard.SaveVcf("CommonFilePath.vcf", VCdVersion.V4_0);

        // Replace the embedded VCards in composersVCard.Members with Guid
        // references in order to save them as separate vCard 4.0 .VCF files.
        // IMPORTANT: Never call Reference() if you intend to serialize
        // a vCard 2.1 or vCard 3.0 !

        IEnumerable<VCard> referenced = composersVCard.Reference();
        // (The extension method can be called on a single VCard because
        // VCard implements IEnumerable<VCard>.)

        Console.WriteLine();
        Console.WriteLine(
            $"After ReferenceVCards() vCardList contains {referenced.Count()} VCard objects.");
        Console.WriteLine();
        Console.WriteLine("composersVCard:");
        Console.WriteLine();
        Console.WriteLine(
            referenced
                .Where(x => x.DisplayNames?
                             .Any(x => StringComparer.Ordinal.Equals(x?.Value, "Composers")) ?? false)
                .First()
                .ToVcfString(VCdVersion.V4_0));

        // Make sure to save ALL VCard objects in `referenced` - otherwise
        // the information originally stored in `composersVCard` will be
        // irrevocably lost.
        foreach (VCard vCard in referenced)
        {
            string fileName = Path.Combine(
                directoryPath,
                $"{vCard.DisplayNames!.First()!.Value}{vcfExtension}");

            vCard.SaveVcf(fileName, VCdVersion.V4_0);
        }

        // Reload the .VCF files:
        IEnumerable<VCard> vCards =
            Vcf.LoadMany(Directory.EnumerateFiles(directoryPath, $"*{vcfExtension}"));

        // Make the reloaded VCard objects searchable. (The Dereference method doesn't
        // change anything in vCards. Don't forget to assign the return value!):
        IEnumerable<VCard> dereferenced = vCards.Dereference();

        // Find the parsed result from "Composers.vcf":
        composersVCard = dereferenced
            .FirstOrDefault
             (
              x => x.DisplayNames?.Any(x => x?.Value == "Composers") ?? false
             );

        if (composersVCard is null)
        {
            Console.WriteLine("Composers.vcf not found!");
        }
        else
        {
            //Retrieve Beethovens birth year from the members of the "Composers.vcf" group:
            Console.Write("What year was Beethoven born?: ");
            Console.WriteLine(
                TryFindBeethovensBirthday(composersVCard, out DateOnly birthDay)
                   ? birthDay.Year
                   : "Don't know.");
        }
    }

    private static VCard InitializeComposerVCard(
        string composersName, DateOnly birthDate, DateOnly deathDate)
        => VCardBuilder.Create()
                       .DisplayNames.Add(composersName)
                       .BirthDayViews.Add(birthDate)
                       .DeathDateViews.Add(deathDate)
                       .VCard;

    private static bool TryFindBeethovensBirthday(VCard composersVCard, out DateOnly birthDay)
    {
        DateOnly date = default;
        bool found = composersVCard.Members
                .OrderByPref()
                .Where(x => x.Value!.VCard is not null)
                .Select(x => x.Value!.VCard)
                    .FirstOrDefault(x => x!.DisplayNames?
                                           .Any(x => x?.Value == "Ludwig van Beethoven") ?? false)?
                    .BirthDayViews?
                    .FirstOrNull(x => x.Value?.TryAsDateOnly(out date) ?? false)
                     is not null;

        birthDay = date;
        return found;
    }
}

/*
Console Output:

After ReferenceVCards() vCardList contains 4 VCard objects.

composersVCard:

BEGIN:VCARD
VERSION:4.0
KIND:group
REV:20240215T212254Z
UID:urn:uuid:51784d87-7ad3-4c47-a199-995544b3c769
FN:Composers
MEMBER;VALUE=URI:urn:uuid:1b5097d0-5e4b-457a-99b0-d0c988e45eb9
MEMBER;VALUE=URI:urn:uuid:733732f0-75c0-44bb-8199-0ce56ce3c4d0
MEMBER;VALUE=URI:urn:uuid:80971089-e932-4e73-a241-6b79415d00d2
END:VCARD

What year was Beethoven born?: 1770
*/
```


## Exceptions
<table>
<tr>
<td><a href="https://learn.microsoft.com/dotnet/api/system.argumentnullexception" target="_blank" rel="noopener noreferrer">ArgumentNullException</a></td>
<td><em>vCards</em> is <code>null</code>.</td></tr>
</table>

## See Also


#### Reference
<a href="23413828-9a4a-2851-b88b-84d0afcb0031.md">VCard Class</a>  
<a href="67dce261-ab8f-dd0a-4c0c-bc2633c1719e.md">FolkerKinzel.VCards Namespace</a>  
